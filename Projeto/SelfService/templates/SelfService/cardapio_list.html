{% extends "Base.html" %}
{% block title %}Cardápio{% endblock %}
{% block header_title %}Cardápio{% endblock %}

{% block content %}
<div class="container-xxl">

  <!-- Título + ações -->
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <h2 class="h3 mb-0">Itens do cardápio</h2>

    <div class="d-flex flex-wrap gap-2">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input id="menuSearch" type="text" class="form-control" placeholder="Buscar por nome ou descrição">
      </div>

      {% if request.session.role == "GERENTE" %}
        <a href="{% url 'cardapio_create' %}" class="btn btn-light">
          <i class="bi bi-plus-lg me-2"></i>Novo item
        </a>
      {% endif %}
    </div>
  </div>

  <!-- Tabela -->
  <div class="card card-glass">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-dark align-middle mb-0" id="menuTable">
          <thead>
            <tr class="text-secondary">
              <th>Nome</th>
              <th>Descrição</th>
              <th class="text-nowrap">Preço</th>
              {% if request.session.role == "GERENTE" %}
                <th class="text-end">Ações</th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for it in itens %}
              <tr>
                <td class="fw-semibold">{{ it.nome }}</td>
                <td class="text-secondary">{{ it.descricao|default:"—" }}</td>
                <td class="text-nowrap">R$ {{ it.preco|default_if_none:0|floatformat:2 }}</td>

                {% if request.session.role == "GERENTE" %}
                  <td class="text-end">
                    <a href="{% url 'cardapio_update' it.pk %}" class="btn btn-outline-light btn-sm">
                      <i class="bi bi-pencil me-1"></i>Editar
                    </a>
                    <a href="{% url 'cardapio_delete' it.pk %}" class="btn btn-outline-danger btn-sm"
                       onclick="return confirm('Excluir {{ it.nome }}? Esta ação não pode ser desfeita.');">
                      <i class="bi bi-trash me-1"></i>Excluir
                    </a>
                  </td>
                {% endif %}
              </tr>
            {% empty %}
              <tr>
                <td colspan="{% if request.session.role == 'GERENTE' %}4{% else %}3{% endif %}"
                    class="text-center text-secondary py-4">
                  Nenhum item cadastrado.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<!-- Busca rápida (client-side) -->
<script>
(() => {
  const input = document.getElementById('menuSearch');
  const tbody = document.querySelector('#menuTable tbody');
  if (!input || !tbody) return;

  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    [...tbody.rows].forEach(tr => {
      tr.classList.toggle('d-none', !tr.innerText.toLowerCase().includes(q));
    });
  });
})();
</script>
{% endblock %}
