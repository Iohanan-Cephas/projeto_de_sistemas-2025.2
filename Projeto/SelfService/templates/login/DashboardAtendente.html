{% extends "Base.html" %}

{% block title %}Painel â€¢ Atendente{% endblock %}
{% block header_title %}Painel do Atendente{% endblock %}
{% block profile_icon %}AT{% endblock %}

{% block content %}
  <!-- ðŸ”¹ Link para pedidos -->

  <section class="px-4 md:px-8 py-4 border-b">
    <div class="flex flex-wrap gap-2 items-center">
      <button class="btn px-3 py-1.5 rounded-full bg-neutral-900 text-white text-sm filter-btn" data-filter="all">
        Cardapio
      </button>
    </div>
  </section>

  <!-- ðŸ”¹ Grid de mesas + pedidos -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <div id="kanban" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {% for mp in mesas_pedidos %}
        <div class="mesa-card border rounded-xl p-4"
             data-status="{% if mp.mesa.ocupada %}ocupada{% elif mp.mesa.reservada %}reservada{% else %}livre{% endif %}"
             data-pedido="{% if mp.pedidos %}pedido{% else %}sem-pedido{% endif %}">

          <!-- CabeÃ§alho da mesa -->
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">Mesa {{ mp.mesa.numero }}</h3>
            {% if mp.mesa.ocupada %}
              <span class="text-xs px-2 py-0.5 rounded-full bg-yellow-100">ocupada</span>
            {% endif %}
            {% if mp.mesa.reservada %}
              <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100">reservada</span>
            {% endif %}
          </div>

          <!-- Pedidos -->
          {% if mp.pedidos %}
            <ul class="space-y-2">
              {% for p in mp.pedidos %}
                <li class="p-2 rounded border">
                  <div class="flex items-center justify-between">
                    <span class="text-sm">Pedido #{{ p.id }}</span>
                    <span class="text-xs px-2 py-0.5 rounded-full bg-neutral-100">
                      {{ p.get_status_display }}
                    </span>
                  </div>
                  <div class="text-xs text-neutral-500">Criado em {{ p.criado_em|date:"d/m/Y H:i" }}</div>
                  <ul class="mt-2 text-sm list-disc ml-5">
                    {% for ip in p.itens_pedido.all %}
                      <li>{{ ip.quantidade }}Ã— {{ ip.item.nome }} â€” R$ {{ ip.item.preco }}</li>
                    {% endfor %}
                  </ul>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-neutral-500 text-sm">Sem pedidos.</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </section>

  <!-- ðŸ”¹ Script de filtro -->
  <script>
    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const filter = btn.dataset.filter;

        // Resetar estilo dos botÃµes
        document.querySelectorAll(".filter-btn").forEach(b => {
          b.classList.remove("bg-neutral-900", "text-white");
          b.classList.add("bg-neutral-100", "text-black");
        });

        // Destacar botÃ£o ativo
        btn.classList.remove("bg-neutral-100", "text-black");
        btn.classList.add("bg-neutral-900", "text-white");

        // Aplicar filtro nos cards
        document.querySelectorAll(".mesa-card").forEach(card => {
          const status = card.dataset.status;
          const pedido = card.dataset.pedido;

          if (filter === "all") {
            card.style.display = "";
          } else if (filter === "ocupada" && status === "ocupada") {
            card.style.display = "";
          } else if (filter === "reservada" && status === "reservada") {
            card.style.display = "";
          } else if (filter === "pedido" && pedido === "pedido") {
            card.style.display = "";
          } else if (filter === "reservar" && status === "livre") {
            card.style.display = "";
          } else {
            card.style.display = "none";
          }
        });
      });
    });
  </script>

{% endblock %}
