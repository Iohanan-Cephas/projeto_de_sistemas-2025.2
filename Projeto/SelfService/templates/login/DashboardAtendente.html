{% extends "Base.html" %}

{% block title %}Painel • Atendente{% endblock %}
{% block header_title %}Painel do Atendente{% endblock %}
{% block profile_icon %}AT{% endblock %}

{% block content %}
  <div class="flex justify-end pr-4 pt-3">
    <a href="{% url 'pedidos_por_mesa' %}" class="text-sm underline">Ver pedidos por mesa</a>
  </div>

  <!-- Filtros -->
  <section class="px-4 md:px-8 py-4 border-b">
    <div class="flex flex-wrap gap-2 items-center">
      <a href="{% url 'pedidos_por_mesa' %}">
  <button class="btn px-3 py-1.5 rounded-full bg-neutral-900 text-white text-sm filter-btn" data-filter="all">
    Todas as mesas
  </button>
</a>
      <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm filter-btn" data-filter="ocupada">Ocupadas</button>
      <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm filter-btn" data-filter="reservada">Reservadas</button>
      <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm filter-btn" data-filter="pedido">Pedidos</button>
      <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm filter-btn" data-filter="reservar">Reservar</button>
    </div>
  </section>

  <!-- Kanban simples -->
  <div id="kanban" class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-6 mt-6">

    <!-- Criados -->
    <section class="space-y-3">
      <header class="flex items-center justify-between">
        <h2 class="text-base font-semibold">Criados</h2>
        <span class="text-xs text-neutral-500">2</span>
      </header>

      <article class="card border border-neutral-200 p-4 elev bg-white filtro pedido">
        <div class="flex items-center justify-between">
          <span class="font-medium">Mesa 01</span>
          <span class="text-xs text-neutral-500">2 min</span>
        </div>
        <p class="text-sm text-neutral-600 mt-1">2 itens • R$ 36,00</p>
        <div class="mt-3 flex gap-2">
          <button class="btn px-3 py-2 rounded-lg bg-neutral-100 text-xs">Detalhes</button>
        </div>
      </article>
    </section>

    <!-- Entregues -->
    <section class="space-y-3">
      <header class="flex items-center justify-between">
        <h2 class="text-base font-semibold">Entregues</h2>
        <span class="text-xs text-neutral-500">3</span>
      </header>

      <article class="card border border-neutral-200 p-4 bg-white filtro reservada">
        <div class="flex items-center justify-between">
          <span class="font-medium"> Mesa 02</span>
          <span class="text-xs text-neutral-500">há 25 min</span>
        </div>
        <p class="text-sm text-neutral-600 mt-1">2 itens • R$ 41,50</p>
        <div class="mt-3 flex gap-2">
          <button class="btn px-3 py-2 rounded-lg bg-neutral-100 text-xs">Recibo</button>
        </div>
      </article>
    </section>

    <!-- Mesas -->
    <section class="space-y-3">
      <header class="flex items-center justify-between">
        <h2 class="text-base font-semibold">Mesas</h2>
        <span class="text-xs text-neutral-500">3</span>
      </header>

      <article class="card border border-neutral-200 p-4 bg-white filtro ocupada">
        <div class="flex items-center justify-between">
          <span class="font-medium">Mesa 03</span>
        </div>
        <p class="text-sm text-neutral-600 mt-1">Disponível/Ocupada</p>
        <div class="mt-3 flex gap-2">
          <button class="btn px-3 py-2 rounded-lg bg-neutral-100 text-xs">Histórico</button>
        </div>
      </article>
    </section>
  </div>

  <!-- JS -->

<script>
document.addEventListener('DOMContentLoaded', () => {
  const filterBtns = document.querySelectorAll('.filter-btn');
  const sections = document.querySelectorAll('#kanban > section');

  function applyFilter(filter) {
    sections.forEach(section => {
      const cards = Array.from(section.querySelectorAll('.filtro'));
      let visibleCount = 0;

      cards.forEach(card => {
        const matches = (filter === 'all') || card.classList.contains(filter);
        if (matches) {
          card.classList.remove('hidden'); // Tailwind hidden = display:none
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // se não tiver cards visíveis, esconda a coluna inteira
      if (visibleCount === 0) {
        section.classList.add('hidden');
      } else {
        section.classList.remove('hidden');
      }

      // atualiza contador no header (opcional)
      const countSpan = section.querySelector('header span.text-xs');
      if (countSpan) countSpan.textContent = visibleCount;
    });
  }

  // comportamento dos botões
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      filterBtns.forEach(b => {
        b.classList.remove('bg-neutral-900', 'text-white');
        b.classList.add('bg-neutral-100');
      });
      btn.classList.remove('bg-neutral-100');
      btn.classList.add('bg-neutral-900', 'text-white');

      applyFilter(btn.dataset.filter);
    });
  });

  // inicializa
  applyFilter('all');
});
</script>
{% endblock %}
