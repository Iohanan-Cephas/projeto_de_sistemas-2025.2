{% extends "Base.html" %}

{% block title %}Painel • Atendente{% endblock %}
{% block header_title %}Painel do Atendente{% endblock %}
{% block profile_icon %}AT{% endblock %}

{% block content %}
  

<div class="flex justify-end pr-4 pt-3">
  <a href="{% url 'pedidos_por_mesa' %}" 
     class="text-sm underline">
     Ver pedidos por mesa
  </a>
</div>




<!-- Filtros de mesas e cardápio -->
<section class="px-4 md:px-8 py-4 border-b">
  <div class="flex flex-wrap gap-2 items-center">

    <!-- Link estilizado como botão -->
    <a href="{% url 'pedidos_por_mesa' %}" 
       class="btn px-3 py-1.5 rounded-full bg-neutral-900 text-white text-sm">
       Todas as mesas
    </a>

    <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm">Ocupadas</button>
    <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm">Reservadas</button>
    <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm">Pedidos</button>
    <button class="btn px-3 py-1.5 rounded-full bg-neutral-100 text-sm">Reservar</button>

    <!-- Cardápio  -->
    <a href="{% url 'cardapio_list' %}"
       class="btn px-3 py-1.5 rounded-full text-sm 
              {% if request.resolver_match.url_name == 'cardapio_list' %}
                bg-neutral-900 text-white
              {% else %}
                bg-neutral-100
              {% endif %}">
       Cardápio
    </a>
  </div>
</section>















<section class="card border border-neutral-200 bg-white p-5 elev mt-8">
  <div class="flex items-center justify-between mb-4">
    <h2 class="font-semibold">Histórico de Pedidos</h2>
    <form method="get" class="flex gap-2">
      <select name="status" class="text-sm border rounded-full px-2 py-1.5"
              onchange="this.form.submit()">
        <option value="todos" {% if request.GET.status == "todos" %}selected{% endif %}>Status: todos</option>
        <option value="P" {% if request.GET.status == "P" %}selected{% endif %}>Pendente</option>
        <option value="E" {% if request.GET.status == "E" %}selected{% endif %}>Em preparo</option>
        <option value="C" {% if request.GET.status == "C" %}selected{% endif %}>Concluído</option>
        <option value="F" {% if request.GET.status == "F" %}selected{% endif %}>Faturado</option>
      </select>
      <input type="text" name="q" value="{{ request.GET.q }}"
             class="text-sm border rounded-full px-3 py-1.5"
             placeholder="Buscar...">
    </form>
  </div>

  <div class="overflow-auto">
    <table class="min-w-full text-sm">
      <thead class="text-left text-neutral-500">
        <tr>
          <th class="py-2 pr-4">#</th>
          <th class="py-2 pr-4">Mesa</th>
          <th class="py-2 pr-4">Itens</th>
          <th class="py-2 pr-4">Total</th>
          <th class="py-2 pr-4">Atendente</th>
          <th class="py-2 pr-4">Status Pedido</th>
          <th class="py-2">Status Mesa</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for pedido in pedidos %}
        <tr>
          <td class="py-2 pr-4 font-medium">#{{ pedido.id }}</td>
          <td class="py-2 pr-4">Mesa {{ pedido.mesa.numero }}</td>
          <td class="py-2 pr-4">{{ pedido.itens.count }}</td>
          <td class="py-2 pr-4">R$ {{ pedido.total|floatformat:2 }}</td>
          <td class="py-2">{{ pedido.atendente.username }}</td>
          <td class="py-2">
            <span class="px-2 py-0.5 rounded-full bg-neutral-100 text-xs">
              {{ pedido.get_status_display }}
            </span>
          </td>
          <td class="py-2">
            {% if pedido.mesa.ocupada %}
              <span class="px-2 py-0.5 rounded-full bg-yellow-100 text-xs">Ocupada</span>
            {% elif pedido.mesa.reservada %}
              <span class="px-2 py-0.5 rounded-full bg-blue-100 text-xs">Reservada</span>
            {% else %}
              <span class="px-2 py-0.5 rounded-full bg-green-100 text-xs">Livre</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center py-4 text-neutral-500">Nenhum pedido encontrado.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>


{% endblock %}
